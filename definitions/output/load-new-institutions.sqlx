config { type: "operations" }

MERGE INTO
  ${ref("dim_institution")} AS TARGET
USING (
  SELECT *
  FROM ${ref("es-institutions")}
  WHERE institution_id IS NOT NULL
) AS source
ON
  target.realm = source.realm
WHEN NOT MATCHED THEN
    INSERT (institution_id, codename, realm)
VALUES
  (source.institution_id, source.codename, source.realm)